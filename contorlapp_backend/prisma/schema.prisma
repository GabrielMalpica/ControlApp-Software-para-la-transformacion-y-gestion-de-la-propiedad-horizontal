/* =========================================
   GENERATORS & DATASOURCE
========================================= */

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./ERD.svg"
  // engine = "graphviz"
  // theme  = "dark"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =========================================
   ENUMS - IDENTIDAD / RRHH
========================================= */

enum Rol {
  gerente
  administrador
  jefe_operaciones
  supervisor
  operario
}

enum EstadoCivil {
  SOLTERO
  CASADO
  UNION_LIBRE
  VIUDOA
}

enum TipoSangre {
  O_POSITIVO
  O_NEGATIVO
  A_POSITIVO
  A_NEGATIVO
  B_POSITIVO
  B_NEGATIVO
  AB_POSITIVO
  AB_NEGATIVO
}

enum EPS {
  SANITAS
  NUEVA_EPS
  SALUD_TOTAL
  SURA
  COMPENSAR
  FAMISANAR
  COOSALUD
  MUTUAL_SER
  SAVIA_SALUD
  CAPITAL_SALUD
  ASMET_SALUD
  ECOOPSOS
  EMSSANAR
  CAJACOPI
  COMFENALCO_ANTIOQUIA
  COMFACHOCO
  COMPARTA
  DUSAKAWI
  MALLAMAS
  ANAS_WAIMAS
}

enum FondoPension {
  COLPENSIONES
  PORVENIR
  PROTECCION
  COLFONDOS
  SKANDIA
  OLD_MUTUAL
}

enum TipoContrato {
  TERMINO_INDEFINIDO
  TERMINO_FIJO
  OBRA_LABOR
}

enum JornadaLaboral {
  COMPLETA
  MEDIO_TIEMPO
  FINES_DE_SEMANA
}

enum TallaCamisa {
  XS
  S
  M
  L
  XL
  XXL
  XXXL
}

enum TallaPantalon {
  T_28
  T_30
  T_32
  T_34
  T_36
  T_38
  T_40
  T_42
  F_6
  F_8
  F_10
  F_12
  F_14
  F_16
}

enum TallaCalzado {
  T_34
  T_35
  T_36
  T_37
  T_38
  T_39
  T_40
  T_41
  T_42
  T_43
  T_44
}

enum TipoFuncion {
  TODERO
  SALVAVIDAS
  ASEO
}

/* =========================================
   ENUMS - OPERACIÓN / SERVICIOS / AGENDA
========================================= */

enum TipoServicio {
  JARDINERIA
  PISCINA
  ASEO
  MANTENIMIENTOS_LOCATIVOS
  SALVAMENTO_ACUATICO
}

enum Frecuencia {
  DIARIA
  SEMANAL
  QUINCENAL
  MENSUAL
  BIMESTRAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}

enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO
}

enum TipoTarea {
  PREVENTIVA
  CORRECTIVA
}

enum EstadoTarea {
  ASIGNADA
  EN_PROCESO
  COMPLETADA
  APROBADA
  PENDIENTE_APROBACION
  RECHAZADA
  NO_COMPLETADA
  PENDIENTE_REPROGRAMACION
}

enum EstadoSolicitud {
  PENDIENTE
  APROBADA
  RECHAZADA
}

/* =========================================
   ENUMS - INSUMOS / INVENTARIO
========================================= */

enum CategoriaInsumo {
  LIMPIEZA
  JARDINERIA
  PISCINA
}

enum UnidadCalculo {
  M
  UNIDAD
  M2
  M3
  ML
  LITRO
  KILO
  HORA
}

enum TipoMovimientoInsumo {
  ENTRADA
  SALIDA
  AJUSTE
}

/* =========================================
   ENUMS - MAQUINARIA
========================================= */

enum TipoMaquinaria {
  CORTASETOS_MANO
  CORTASETOS_ALTURA
  GUADANIA
  PODADORA_CESPED
  ESCALERA
  SOPLADORA
  FUMIGADORA_MOTOR
  BOMBA_ESPALDA
  MOTOSIERRA_MANO
  MOTOSIERRA_ALTURA
  HIDROLAVADORA_ELECTRICA
  HIDROLAVADORA_GASOLINA
  PULIDORA
  TALADRO
  ROTOMARTILLO
  LAVABRILLADORA
  COMPRESOR
  PULVERIZADORA_PINTURA
  EQUIPO_ALTURAS
  MEDIA_LUNA
  CAJA_HERRAMIENTAS
  OTRO
}

enum EstadoMaquinaria {
  OPERATIVA
  EN_REPARACION
  FUERA_DE_SERVICIO
}

enum PropietarioMaquinaria {
  EMPRESA
  CONJUNTO
}

enum TipoTenenciaMaquinaria {
  PROPIA
  PRESTADA
}

enum EstadoAsignacionMaquinaria {
  ACTIVA
  DEVUELTA
  INACTIVA
}

enum EstadoSolicitudMaquinaria {
  PENDIENTE
  APROBADA
  RECHAZADA
  CANCELADA
  DEVUELTA
}

/* =========================================
   ENUMS - RENDIMIENTOS
========================================= */

enum RendimientoBaseTiempo {
  POR_HORA
  POR_MINUTO
  MIN_POR_UNIDAD
}

/* =========================================
   MODELOS - CONFIG / MAESTROS
========================================= */

model ConfiguracionSistema {
  id    Int    @id @default(autoincrement())
  clave String @unique
  valor String
}

/* =========================================
   MODELOS - NÚCLEO EMPRESA / USUARIOS / ROLES
========================================= */

model Usuario {
  id              String     @id
  nombre          String
  correo          String     @unique
  contrasena      String
  rol             String
  telefono        BigInt
  fechaNacimiento DateTime
  direccion       String?
  estadoCivil     EstadoCivil?
  numeroHijos     Int?
  padresVivos     Boolean?
  tipoSangre      TipoSangre?
  eps             EPS?
  fondoPensiones  FondoPension?
  tallaCamisa     TallaCamisa?
  tallaPantalon   TallaPantalon?
  tallaCalzado    TallaCalzado?
  tipoContrato    TipoContrato?
  jornadaLaboral  JornadaLaboral?

  gerente         Gerente?
  jefeOperaciones JefeOperaciones?
  supervisor      Supervisor?
  operario        Operario?
  administrador   Administrador?
}

model Empresa {
  id                Int    @id @default(autoincrement())
  nombre            String
  nit               String @unique
  limiteHorasSemana Int    @default(42)

  // Roles
  gerentes         Gerente[]
  jefesOperaciones JefeOperaciones[]
  supervisores     Supervisor[]
  operarios        Operario[]

  // Clientes/Conjuntos
  conjuntos Conjunto[]

  // Catálogos/Stock
  stockMaquinaria Maquinaria[]
  catalogoInsumos  Insumo[]

  // Solicitudes
  solicitudesTareas     SolicitudTarea[]
  solicitudesInsumos    SolicitudInsumo[]
  solicitudesMaquinaria SolicitudMaquinaria[]

  // Flujo de aprobación/rechazo
  tareasAprobadas  Tarea[] @relation("EmpresaTareasAprobadas")
  tareasRechazadas Tarea[] @relation("EmpresaTareasRechazadas")

  // Analítica/consumos
  insumosConsumidos InsumoConsumoEmpresa[]
  Rendimiento       Rendimiento[]

  @@map("Empresa")
}

model Gerente {
  id        String   @id
  usuario   Usuario  @relation(fields: [id], references: [id], onDelete: Cascade)
  empresa   Empresa? @relation(fields: [empresaId], references: [nit])
  empresaId String?

  @@map("Gerente")
}

model Administrador {
  id        String     @id
  usuario   Usuario    @relation(fields: [id], references: [id], onDelete: Cascade)
  conjuntos Conjunto[]

  @@map("Administrador")
}

model JefeOperaciones {
  id      String  @id
  usuario Usuario @relation(fields: [id], references: [id], onDelete: Cascade)

  empresa   Empresa @relation(fields: [empresaId], references: [nit])
  empresaId String

  @@map("JefeOperaciones")
}

model Supervisor {
  id      String  @id
  usuario Usuario @relation(fields: [id], references: [id], onDelete: Cascade)

  empresa   Empresa @relation(fields: [empresaId], references: [nit])
  empresaId String

  tareasPorVerificar         Tarea[]
  definicionTareaPreventivas DefinicionTareaPreventiva[]

  @@map("Supervisor")
}

model Operario {
  id                        String      @id
  usuario                   Usuario     @relation(fields: [id], references: [id], onDelete: Cascade)
  funciones                 TipoFuncion[]
  tareas                    Tarea[]     @relation("TareaOperarios")
  conjuntos                 Conjunto[]  @relation("OperarioConjuntos")

  cursoSalvamentoAcuatico   Boolean
  urlEvidenciaSalvamento    String?
  cursoAlturas              Boolean
  urlEvidenciaAlturas       String?
  examenIngreso             Boolean
  urlEvidenciaExamenIngreso String?

  fechaIngreso           DateTime
  fechaSalida            DateTime?
  fechaUltimasVacaciones DateTime?
  observaciones          String?

  consumos              ConsumoInsumo[]
  maquinariaAsignada    Maquinaria[]
  solicitudesMaquinaria SolicitudMaquinaria[]

  empresa   Empresa @relation(fields: [empresaId], references: [nit])
  empresaId String

  definicionesPreventivas DefinicionTareaPreventiva[] @relation("DefinicionOperarios")
  maquinariaConjuntos     MaquinariaConjunto[]
  usoMaquinarias          UsoMaquinaria[]

  @@map("Operario")
}

/* =========================================
   MODELOS - CLIENTE / SITIO (CONJUNTO) / HORARIOS
========================================= */

model Conjunto {
  nit       String @id
  nombre    String
  direccion String
  correo    String

  administrador   Administrador? @relation(fields: [administradorId], references: [id])
  administradorId String?

  empresa   Empresa? @relation(fields: [empresaId], references: [nit], onDelete: Cascade)
  empresaId String?

  fechaInicioContrato DateTime?
  fechaFinContrato    DateTime?
  activo              Boolean        @default(true)
  tipoServicio        TipoServicio[]
  valorMensual        Decimal?       @db.Decimal(14, 2)
  consignasEspeciales String[]       @default([])
  valorAgregado       String[]       @default([])

  // Operación
  operarios   Operario[] @relation("OperarioConjuntos")
  inventario  Inventario?
  ubicaciones Ubicacion[]
  cronograma  Tarea[]

  // Solicitudes
  solicitudesTareas     SolicitudTarea[]
  solicitudesInsumos    SolicitudInsumo[]
  solicitudesMaquinaria SolicitudMaquinaria[]

  // Config/agenda
  horarios                  ConjuntoHorario[]
  DefinicionTareaPreventiva DefinicionTareaPreventiva[]

  // Overrides / maquinaria
  limiteHorasSemanaOverride Int?
  maquinariaConjuntos       MaquinariaConjunto[]
  maquinarias               Maquinaria[]
}

model ConjuntoHorario {
  id         Int      @id @default(autoincrement())
  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit], onDelete: Cascade)
  conjuntoId String

  dia          DiaSemana
  horaApertura String
  horaCierre   String

  descansoInicio String?
  descansoFin    String?

  @@unique([conjuntoId, dia])
}

/* =========================================
   MODELOS - UBICACIÓN / ELEMENTOS
========================================= */

model Ubicacion {
  id     Int    @id @default(autoincrement())
  nombre String

  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit], onDelete: Cascade)
  conjuntoId String

  elementos                 Elemento[]
  tareas                    Tarea[]
  solicitudesTareas         SolicitudTarea[]
  DefinicionTareaPreventiva DefinicionTareaPreventiva[]

  @@map("Ubicacion")
}

model Elemento {
  id     Int    @id @default(autoincrement())
  nombre String

  ubicacion   Ubicacion @relation(fields: [ubicacionId], references: [id], onDelete: Cascade)
  ubicacionId Int

  tareas                    Tarea[]
  solicitudesTareas         SolicitudTarea[]
  DefinicionTareaPreventiva DefinicionTareaPreventiva[]

  @@map("Elemento")
}

/* =========================================
   MODELOS - INSUMOS / INVENTARIO / CONSUMOS
========================================= */

model Insumo {
  id        Int            @id @default(autoincrement())
  nombre    String
  unidad    String
  categoria CategoriaInsumo
  umbralBajo Int?

  empresa   Empresa @relation(fields: [empresaId], references: [nit])
  empresaId String

  inventarios                InventarioInsumo[]
  consumos                   ConsumoInsumo[]
  consumosEmpresa            InsumoConsumoEmpresa[]
  solicitudInsumoItem        SolicitudInsumoItem[]
  definicionTareaPreventivas DefinicionTareaPreventiva[]
  tareas                     Tarea[]

  @@unique([empresaId, nombre, unidad])
  @@map("Insumo")
}

model Inventario {
  id         Int      @id @default(autoincrement())
  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit])
  conjuntoId String   @unique

  insumos  InventarioInsumo[]
  consumos ConsumoInsumo[]

  @@map("Inventario")
}

model InventarioInsumo {
  id           Int        @id @default(autoincrement())
  inventario   Inventario @relation(fields: [inventarioId], references: [id])
  inventarioId Int

  insumo   Insumo @relation(fields: [insumoId], references: [id])
  insumoId Int

  cantidad     Decimal @db.Decimal(14, 4)
  umbralMinimo Int?

  @@unique([inventarioId, insumoId])
  @@index([inventarioId, cantidad])
}

model ConsumoInsumo {
  id           Int        @id @default(autoincrement())
  inventario   Inventario @relation(fields: [inventarioId], references: [id])
  inventarioId Int

  insumo   Insumo               @relation(fields: [insumoId], references: [id])
  insumoId Int
  tipo     TipoMovimientoInsumo @default(SALIDA)

  operario   Operario? @relation(fields: [operarioId], references: [id])
  operarioId String?

  tarea   Tarea? @relation(fields: [tareaId], references: [id])
  tareaId Int?

  cantidad    Decimal  @db.Decimal(14, 4)
  fecha       DateTime
  observacion String?

  @@map("ConsumoInsumo")
}

model InsumoConsumoEmpresa {
  id     Int    @id @default(autoincrement())
  insumo Insumo @relation(fields: [insumoId], references: [id])
  insumoId Int

  empresa   Empresa @relation(fields: [empresaId], references: [nit])
  empresaId String

  cantidad Int
  fecha    DateTime
}

/* =========================================
   MODELOS - MAQUINARIA / ASIGNACIONES / USO
========================================= */

model Maquinaria {
  id     Int    @id @default(autoincrement())
  nombre String
  marca  String
  tipo   TipoMaquinaria
  estado EstadoMaquinaria @default(OPERATIVA)

  propietarioTipo       PropietarioMaquinaria
  empresa               Empresa?  @relation(fields: [empresaId], references: [nit])
  empresaId             String?
  conjuntoPropietario   Conjunto? @relation(fields: [conjuntoPropietarioId], references: [nit])
  conjuntoPropietarioId String?

  asignaciones         MaquinariaConjunto[]
  operario             Operario? @relation(fields: [operarioId], references: [id])
  operarioId           String?
  solicitudMaquinarias SolicitudMaquinaria[]
  usoMaquinarias       UsoMaquinaria[]

  @@map("Maquinaria")
}

model MaquinariaConjunto {
  id         Int      @id @default(autoincrement())
  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit])
  conjuntoId String

  maquinaria   Maquinaria @relation(fields: [maquinariaId], references: [id])
  maquinariaId Int

  tipoTenencia TipoTenenciaMaquinaria
  estado       EstadoAsignacionMaquinaria @default(ACTIVA)

  fechaInicio             DateTime  @default(now())
  fechaFin                DateTime?
  fechaDevolucionEstimada DateTime?

  responsable Operario? @relation(fields: [operarioId], references: [id])
  operarioId  String?

  solicitudMaquinaria SolicitudMaquinaria?

  @@unique([conjuntoId, maquinariaId, estado])
  @@index([conjuntoId, estado])
  @@index([maquinariaId, estado])
}

model UsoMaquinaria {
  id Int @id @default(autoincrement())

  tarea   Tarea @relation(fields: [tareaId], references: [id])
  tareaId Int

  maquinaria   Maquinaria @relation(fields: [maquinariaId], references: [id])
  maquinariaId Int

  operario   Operario? @relation(fields: [operarioId], references: [id])
  operarioId String?

  fechaInicio DateTime  @default(now())
  fechaFin    DateTime?
  observacion String?

  @@index([tareaId])
  @@index([maquinariaId])
}

/* =========================================
   MODELOS - TAREAS / DEFINICIONES PREVENTIVAS
========================================= */

model DefinicionTareaPreventiva {
  id Int @id @default(autoincrement())

  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit], onDelete: Cascade)
  conjuntoId String

  ubicacion   Ubicacion @relation(fields: [ubicacionId], references: [id])
  ubicacionId Int
  elemento    Elemento  @relation(fields: [elementoId], references: [id])
  elementoId  Int

  descripcion         String
  frecuencia          Frecuencia
  prioridad           Int        @default(2)
  diaSemanaProgramado DiaSemana?
  diaMesProgramado    Int?

  // Duración planificada
  unidadCalculo         UnidadCalculo?
  areaNumerica          Decimal?               @db.Decimal(14, 4)
  rendimientoBase       Decimal?
  rendimientoTiempoBase RendimientoBaseTiempo? @default(POR_HORA)
  duracionMinutosFija   Int?

  // Recursos planeados
  insumoPrincipalId         Int?
  insumoPrincipal           Insumo?  @relation(fields: [insumoPrincipalId], references: [id])
  consumoPrincipalPorUnidad Decimal? @db.Decimal(14, 4)
  insumosPlanJson           Json?
  maquinariaPlanJson        Json?

  // Operarios sugeridos (M:N)
  operarios Operario[] @relation("DefinicionOperarios")

  // Supervisor responsable
  supervisorId String?
  supervisor   Supervisor? @relation(fields: [supervisorId], references: [id])

  activo        Boolean  @default(true)
  creadoEn      DateTime @default(now())
  actualizadoEn DateTime @updatedAt

  rendimientoId Int?
  rendimiento   Rendimiento? @relation(fields: [rendimientoId], references: [id])

  cuadrillaSugerida     Int?
  factoresSugeridosJson Json?

  insumosSiteOverrideJson Json?

  @@map("DefinicionTareaPreventiva")
}

model Tarea {
  id                  Int         @id @default(autoincrement())
  descripcion         String
  fechaInicio         DateTime
  fechaFin            DateTime
  fechaIniciarTarea   DateTime?
  fechaFinalizarTarea DateTime?
  duracionMinutos     Int
  prioridad           Int         @default(2)
  estado              EstadoTarea @default(ASIGNADA)

  evidencias           String[] @default([])
  insumosUsados        Json?
  observaciones        String?
  observacionesRechazo String?
  fechaVerificacion    DateTime?

  operarios    Operario[]  @relation("TareaOperarios")
  supervisor   Supervisor? @relation(fields: [supervisorId], references: [id])
  supervisorId String?

  ubicacion   Ubicacion @relation(fields: [ubicacionId], references: [id])
  ubicacionId Int
  elemento    Elemento  @relation(fields: [elementoId], references: [id])
  elementoId  Int

  conjunto   Conjunto? @relation(fields: [conjuntoId], references: [nit])
  conjuntoId String?

  empresaAprobadaId  Int?
  empresaAprobada    Empresa? @relation("EmpresaTareasAprobadas", fields: [empresaAprobadaId], references: [id])
  empresaRechazadaId Int?
  empresaRechazada   Empresa? @relation("EmpresaTareasRechazadas", fields: [empresaRechazadaId], references: [id])

  tipo       TipoTarea   @default(CORRECTIVA)
  frecuencia Frecuencia?

  // Planificación / cronograma
  borrador       Boolean @default(false)
  periodoAnio    Int?
  periodoMes     Int?
  grupoPlanId    String?
  bloqueIndex    Int?
  bloquesTotales Int?

  // Rendimientos / estimaciones
  tiempoEstimadoMinutos     Int?
  insumoPrincipalId         Int?
  insumoPrincipal           Insumo?  @relation(fields: [insumoPrincipalId], references: [id])
  consumoPrincipalPorUnidad Decimal? @db.Decimal(14, 4)
  consumoTotalEstimado      Decimal? @db.Decimal(14, 4)
  insumosPlanJson           Json?
  maquinariaPlanJson        Json?

  ConsumoInsumo        ConsumoInsumo[]
  rendimientoId        Int?
  rendimiento          Rendimiento?         @relation(fields: [rendimientoId], references: [id])
  rendimientoVersion   Int?
  rendimientoAplicado  RendimientoAplicado?
  usoMaquinarias       UsoMaquinaria[]

  @@index([conjuntoId, fechaInicio])
  @@index([conjuntoId, fechaFin])
  @@index([periodoAnio, periodoMes, conjuntoId])
  @@index([grupoPlanId, bloqueIndex])
  @@index([rendimientoId])
  @@map("Tarea")
}

/* =========================================
   MODELOS - SOLICITUDES
========================================= */

model SolicitudTarea {
  id            Int             @id @default(autoincrement())
  descripcion   String
  duracionHoras Int
  estado        EstadoSolicitud @default(PENDIENTE)
  observaciones String?

  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit])
  conjuntoId String

  ubicacion   Ubicacion @relation(fields: [ubicacionId], references: [id])
  ubicacionId Int
  elemento    Elemento  @relation(fields: [elementoId], references: [id])
  elementoId  Int

  empresa   Empresa? @relation(fields: [empresaId], references: [nit])
  empresaId String?
}

model SolicitudInsumo {
  id              Int      @id @default(autoincrement())
  fechaSolicitud  DateTime @default(now())
  fechaAprobacion DateTime?
  aprobado        Boolean  @default(false)

  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit])
  conjuntoId String

  empresa   Empresa? @relation(fields: [empresaId], references: [nit])
  empresaId String?

  insumosSolicitados SolicitudInsumoItem[]
}

model SolicitudInsumoItem {
  id Int @id @default(autoincrement())

  solicitud   SolicitudInsumo @relation(fields: [solicitudId], references: [id], onDelete: Cascade)
  solicitudId Int

  insumo   Insumo @relation(fields: [insumoId], references: [id])
  insumoId Int

  cantidad Decimal @db.Decimal(14, 4)

  @@unique([solicitudId, insumoId])
}

model SolicitudMaquinaria {
  id                      Int      @id @default(autoincrement())
  fechaSolicitud          DateTime @default(now())
  fechaUso                DateTime
  fechaDevolucionEstimada DateTime
  fechaAprobacion         DateTime?

  estado               EstadoSolicitudMaquinaria @default(PENDIENTE)
  observacionRespuesta String?

  conjunto   Conjunto @relation(fields: [conjuntoId], references: [nit])
  conjuntoId String

  maquinaria   Maquinaria @relation(fields: [maquinariaId], references: [id])
  maquinariaId Int

  responsable Operario @relation(fields: [operarioId], references: [id])
  operarioId  String

  empresa   Empresa? @relation(fields: [empresaId], references: [nit])
  empresaId String?

  maquinariaConjuntoId Int?                @unique
  maquinariaConjunto   MaquinariaConjunto? @relation(fields: [maquinariaConjuntoId], references: [id])

  @@index([conjuntoId, estado])
  @@index([maquinariaId, estado])
}

/* =========================================
   MODELOS - RENDIMIENTO
========================================= */

model Rendimiento {
  id                         Int     @id @default(autoincrement())
  actividad                  String
  tipoServicio               TipoServicio
  unidadCalculo              UnidadCalculo
  rendimientoBasePorOperario Decimal @db.Decimal(14, 4)

  curvaCuadrillaJson        Json?
  factoresJson              Json?
  insumosBaseJson           Json?
  herramientasSugeridasJson Json?

  mermaPorcentaje    Decimal?  @db.Decimal(5, 2)
  frecuenciaSugerida Frecuencia?
  version            Int       @default(1)
  vigenteDesde       DateTime? @default(now())
  vigenteHasta       DateTime?

  empresa   Empresa? @relation(fields: [empresaId], references: [nit])
  empresaId String?

  definiciones    DefinicionTareaPreventiva[]
  tareasAplicadas RendimientoAplicado[]
  Tarea           Tarea[]

  @@index([tipoServicio, actividad])
  @@index([empresaId])
}

model RendimientoAplicado {
  id Int @id @default(autoincrement())

  tarea   Tarea @relation(fields: [tareaId], references: [id], onDelete: Cascade)
  tareaId Int   @unique

  rendimiento   Rendimiento @relation(fields: [rendimientoId], references: [id])
  rendimientoId Int

  cuadrillaPersonas  Int
  factoresUsadosJson Json?

  areaNumerica    Decimal? @db.Decimal(14, 4)
  unidadCalculo   UnidadCalculo?
  consumoBaseJson Json?
  herramientasJson Json?

  rendimientoCalculadoPorPersona Decimal? @db.Decimal(14, 4)
  rendimientoCuadrilla           Decimal? @db.Decimal(14, 4)
  horasCalculadas                Decimal? @db.Decimal(14, 4)
  consumoTotalEstimado           Decimal? @db.Decimal(14, 4)

  creadoEn DateTime @default(now())

  @@index([tareaId])
  @@index([rendimientoId])
}

/* =========================================
   MODELOS - CALENDARIO (FESTIVOS)
========================================= */

model Festivo {
  id       Int      @id @default(autoincrement())
  fecha    DateTime @unique
  nombre   String?
  pais     String   @default("CO")
  creadoEn DateTime @default(now())
}
